<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="ZÃªluz DC">
  <meta name="theme-color" content="#234D67">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="logo.png">
  <title>ZÃªluzÂ® - Dash Geral Daycare - IC.'. âˆ</title>
  <!-- Open Graph â€” preview WhatsApp, redes sociais -->
  <meta property="og:type"        content="website">
  <meta property="og:title"       content="ZÃªluzÂ® - Dash Geral Daycare - IC.'. âˆ">
  <meta property="og:description" content="Painel de monitoramento diÃ¡rio do DayCare ZÃªluz">
  <meta property="og:image"       content="https://zoeharus-art.github.io/dashboard-daycare1-zeluz/logo.png">
  <meta property="og:url"         content="https://zoeharus-art.github.io/dashboard-daycare1-zeluz/">
  <meta property="og:site_name"   content="ZÃªluzÂ® Pet DayCare">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,600&display=swap" rel="stylesheet">
  <style>
    :root {
      /* â”€â”€â”€ Marca ZÃªluz â”€â”€â”€ */
      --amarelo:  #C9971C;
      --azul:     #234D67;
      --preto:    #1D1E1C;
      --branco:   #FFFFFF;
      --creme:    #FAF8F4;

      /* â”€â”€â”€ Banho: azul Ã¡gua alegre â”€â”€â”€ */
      --banho-h:  #2A8FAF;
      --banho-l:  #E5F4FA;
      --banho-e:  rgba(42,143,175,.08);

      /* â”€â”€â”€ VeterinÃ¡rio: verde saÃºde claro â”€â”€â”€ */
      --vet-h:    #3C9B6B;
      --vet-l:    #E6F6EE;
      --vet-e:    rgba(60,155,107,.08);

      /* â”€â”€â”€ AdaptaÃ§Ã£o: lilÃ¡s bem-estar â”€â”€â”€ */
      --adapt-h:  #8B6FC4;
      --adapt-l:  #EEE8FA;
      --adapt-e:  rgba(139,111,196,.08);

      /* â”€â”€â”€ Alerta: vermelho saÃºde â€” mÃ¡xima atenÃ§Ã£o â”€â”€â”€ */
      --alerta-h: #C62828;
      --alerta-l: #FFF0F0;
      --alerta-e: rgba(183,28,28,.07);

      /* â”€â”€â”€ Dourado / outros â”€â”€â”€ */
      --ouro-h:   #B88B0A;
      --ouro-l:   #FDF5DC;
      --ouro-e:   rgba(184,139,10,.08);

      /* â”€â”€â”€ Verde cliente â”€â”€â”€ */
      --verde-h:  #1E7D4B;
      --verde-l:  #E6F5EE;
      --verde-e:  rgba(30,125,75,.08);

      /* â”€â”€â”€ Rosa aniversariante â”€â”€â”€ */
      --rosa-h:   #C2185B;
      --rosa-l:   #FCE4EC;
      --rosa-e:   rgba(194,24,91,.08);

      --btn-verde: #1A8C4E;
      --font: 'Poppins', sans-serif;
    }

    *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
    html, body { height:100%; font-family:var(--font); background:var(--creme); overflow-x:hidden; }
    body { display:flex; flex-direction:column; min-height:100vh; }

    /* â•â•â•â• ANIMAÃ‡Ã•ES â•â•â•â• */
    @keyframes fadeUp {
      from { opacity:0; transform:translateY(22px); }
      to   { opacity:1; transform:translateY(0); }
    }
    @keyframes fadeIn {
      from { opacity:0; }
      to   { opacity:1; }
    }
    @keyframes pulse {
      0%,100% { opacity:1; }
      50%      { opacity:.3; }
    }
    @keyframes spin {
      to { transform:rotate(360deg); }
    }
    @keyframes flash {
      0%,100% { background:rgba(176,0,0,.94); }
      50%      { background:rgba(230,20,20,.99); }
    }
    @keyframes fraseSlide {
      from { opacity:0; transform:translateX(-12px); }
      to   { opacity:1; transform:translateX(0); }
    }
    @keyframes sloganReveal {
      from { opacity:0; letter-spacing:4px; }
      to   { opacity:1; letter-spacing:2px; }
    }

    /* â•â•â•â• HEADER â•â•â•â• */
    .header {
      background: linear-gradient(160deg, #1B3A52 0%, #234D67 60%, #1B3A52 100%);
      flex-shrink: 0;
      box-shadow: 0 4px 20px rgba(0,0,0,.3);
    }
    .header-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 24px;
      padding: 6px 32px;
    }
    .logo-wrap {
      overflow: hidden;
      height: 178px;
      flex-shrink: 0;
      animation: fadeIn .9s ease both;
    }
    .logo-img {
      display: block;
      height: 380px;
      width: auto;
      object-fit: contain;
      margin-top: -95px;
      transition: transform .35s ease;
    }
    .logo-img:hover { transform: scale(1.03); }

    .clock-area {
      text-align: right;
      animation: fadeIn 1.1s ease both;
    }
    .clock-dia  { font-size:10px; font-weight:700; color:rgba(255,255,255,.55); text-transform:uppercase; letter-spacing:2px; }
    .clock-data { font-size:12px; font-weight:600; color:rgba(255,255,255,.7); margin-top:1px; }
    .clock-hora { font-size:52px; font-weight:800; color:#F0C840; line-height:1; letter-spacing:-3px; margin-top:2px; }

    /* â•â•â•â• FRASE DO DIA â€” strip centralizada com destaque â•â•â•â• */
    @keyframes fraseGlow {
      0%,100% { text-shadow: 0 1px 6px rgba(27,58,82,.18); }
      50%      { text-shadow: 0 2px 14px rgba(27,58,82,.38); }
    }
    .frase-strip {
      background: linear-gradient(90deg, #B8880E 0%, #C9971C 30%, #C9971C 70%, #B8880E 100%);
      padding: 14px 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      flex-shrink: 0;
      border-top: 1px solid rgba(27,58,82,.2);
      border-bottom: 1px solid rgba(27,58,82,.2);
    }
    .frase-label {
      font-size: 14px;
      font-weight: 800;
      color: #1B3A52;
      text-transform: uppercase;
      letter-spacing: 3px;
    }
    .frase-texto {
      font-size: 20px;
      font-weight: 600;
      color: #1B3A52;
      font-style: italic;
      line-height: 1.5;
      text-align: center;
      max-width: 960px;
      animation: fraseSlide 1.2s ease both, fraseGlow 3s ease-in-out 1.5s infinite;
    }

    /* â•â•â•â• TABS â•â•â•â• */
    .tabs-bar {
      background: white;
      border-bottom: 2px solid #ece8e0;
      display: flex;
      justify-content: center;
      padding: 0 24px;
      flex-shrink: 0;
    }
    .tab-btn {
      padding: 5px 48px;
      font-family: var(--font);
      font-size: 14px;
      font-weight: 700;
      color: #bbb;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      transition: all .2s;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: -2px;
      letter-spacing: .3px;
    }
    .tab-btn:hover { color: var(--azul); }
    .tab-btn.ativo { color: var(--azul); border-bottom-color: var(--azul); }

    /* â•â•â•â• STATUS BAR â•â•â•â• */
    .status-bar {
      background: var(--azul);
      padding: 8px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-shrink: 0;
    }
    .status-left  { display:flex; align-items:center; gap:8px; }
    .dot { width:9px; height:9px; border-radius:50%; background:#27ae60; flex-shrink:0; }
    .dot.loading  { background:var(--amarelo); animation:pulse .8s infinite; }
    .dot.offline  { background:#e74c3c; }
    .dot.cache    { background:#f39c12; }
    .status-label { font-size:12px; color:white; font-weight:600; }

    .date-nav { display:flex; align-items:center; gap:8px; }
    .date-nav button {
      background:rgba(255,255,255,.12);
      border:1.5px solid rgba(255,255,255,.25);
      color:white;
      padding:5px 16px;
      border-radius:100px;
      font-family:var(--font);
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      transition:all .2s;
    }
    .date-nav button:hover { background:rgba(255,255,255,.22); }
    .btn-hoje { background:var(--amarelo)!important; border-color:var(--amarelo)!important; color:var(--azul)!important; }
    .date-nav .label { font-size:14px; font-weight:700; color:#F0C840; min-width:280px; text-align:center; }

    .status-right { display:flex; align-items:center; gap:10px; }
    .status-timer { font-size:11px; color:rgba(255,255,255,.5); }
    .btn-refresh {
      background: var(--btn-verde);
      border: none;
      color: white;
      padding: 9px 22px;
      border-radius: 100px;
      font-family: var(--font);
      font-size: 14px;
      font-weight: 800;
      cursor: pointer;
      transition: all .2s;
      letter-spacing: .3px;
      box-shadow: 0 3px 10px rgba(0,0,0,.28);
    }
    .btn-refresh:hover { transform:scale(1.05); box-shadow:0 5px 16px rgba(0,0,0,.35); }
    .btn-refresh:disabled { opacity:.5; cursor:not-allowed; transform:none; }
    .btn-diag {
      background: rgba(255,255,255,.09);
      border: 1.5px solid rgba(255,255,255,.22);
      color: rgba(255,255,255,.65);
      padding: 7px 12px;
      border-radius: 100px;
      font-family: var(--font);
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      transition: all .2s;
    }
    .btn-diag:hover { background:rgba(255,255,255,.18); color:white; }

    /* â•â•â•â• MAIN â•â•â•â• */
    .main { flex:1; padding:16px 20px; overflow-y:auto; }
    .cache-banner {
      background:#fff3cd;
      border:1.5px solid #ffc107;
      border-radius:10px;
      padding:8px 14px;
      margin-bottom:12px;
      font-size:13px;
      font-weight:600;
      color:#856404;
      display:none;
    }

    /* â•â•â•â• VISÃƒO GERAL â•â•â•â• */
    #view-geral { display:none; }
    #view-geral.ativo { display:block; }

    .geral-topo { text-align:center; margin-bottom:18px; }
    .geral-titulo    { font-size:20px; font-weight:800; color:var(--azul); }
    .geral-subtitulo { font-size:12px; color:#b0a898; margin-top:3px; }

    .geral-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 13px;
    }
    .geral-card {
      background: white;
      border-radius: 18px;
      box-shadow: 0 3px 16px rgba(35,77,103,.08);
      padding: 26px 14px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 7px;
      border-top: 5px solid #e0dcd4;
      cursor: default;
      transition: transform .22s ease, box-shadow .22s ease;
      opacity: 0;
      animation: fadeUp .45s ease forwards;
    }
    .geral-card:hover { transform: translateY(-4px); box-shadow: 0 10px 28px rgba(35,77,103,.14); }

    .geral-card.banho   { border-top-color: var(--banho-h);  animation-delay: .04s; }
    .geral-card.vet     { border-top-color: var(--vet-h);    animation-delay: .08s; }
    .geral-card.adapt   { border-top-color: var(--adapt-h);  animation-delay: .12s; }
    .geral-card.alerta  { border-top-color: var(--alerta-h); animation-delay: .16s; }
    .geral-card.amarelo { border-top-color: var(--ouro-h);   animation-delay: .20s; }
    .geral-card.verde   { border-top-color: var(--verde-h);  animation-delay: .24s; }
    .geral-card.rosa    { border-top-color: var(--rosa-h);   animation-delay: .28s; }
    .geral-card.futuro  { border-top-color: #ddd; opacity:.35; animation-delay: .32s; }

    .geral-icon  { font-size:30px; }
    .geral-title { font-size:11px; font-weight:700; color:var(--azul); text-align:center; text-transform:uppercase; letter-spacing:.5px; line-height:1.3; }
    .geral-count { font-size:64px; font-weight:800; color:var(--azul); line-height:1; margin:4px 0; }
    .geral-count.zero { color:#ddd; }
    .geral-label { font-size:10px; color:#c0b8a8; font-weight:600; text-transform:uppercase; letter-spacing:1px; }

    /* â•â•â•â• ROTINAS AMIGOS â•â•â•â• */
    #view-rotinas { display:none; }
    #view-rotinas.ativo { display:block; }

    .blocks-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 14px;
    }
    .block {
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 4px 18px rgba(35,77,103,.11);
      display: flex;
      flex-direction: column;
      height: auto;
      transition: box-shadow .25s ease, transform .25s ease;
      opacity: 0;
      animation: fadeUp .5s ease forwards;
    }
    .block:hover { box-shadow: 0 10px 30px rgba(35,77,103,.17); transform: translateY(-2px); }

    .block:nth-child(1)  { animation-delay: .03s; }
    .block:nth-child(2)  { animation-delay: .06s; }
    .block:nth-child(3)  { animation-delay: .09s; }
    .block:nth-child(4)  { animation-delay: .12s; }
    .block:nth-child(5)  { animation-delay: .15s; }
    .block:nth-child(6)  { animation-delay: .18s; }
    .block:nth-child(7)  { animation-delay: .21s; }
    .block:nth-child(8)  { animation-delay: .24s; }
    .block:nth-child(9)  { animation-delay: .27s; }
    .block:nth-child(10) { animation-delay: .30s; }
    .block:nth-child(11) { animation-delay: .33s; }
    .block:nth-child(12) { animation-delay: .36s; }
    .block:nth-child(13) { animation-delay: .39s; }
    .block:nth-child(14) { animation-delay: .42s; }
    .block:nth-child(15) { animation-delay: .45s; }
    .block:nth-child(16) { animation-delay: .48s; }
    .block:nth-child(17) { animation-delay: .51s; }
    .block:nth-child(18) { animation-delay: .54s; }

    .block-header {
      padding: 14px 18px;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-shrink: 0;
    }
    .block-icon  { font-size: 20px; }
    .block-title { font-size: 13px; font-weight:800; text-transform:uppercase; letter-spacing:.5px; line-height:1.2; }
    .block-count { margin-left:auto; font-size:26px; font-weight:800; opacity:.9; flex-shrink:0; }
    .block-body  { padding:6px 12px; display:flex; flex-direction:column; overflow-y:auto; max-height:220px; }

    .block-entry {
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      padding:8px 10px;
      border-radius:10px;
      margin-bottom:3px;
      cursor:pointer;
      transition: background .15s, transform .15s;
      flex-shrink:0;
    }
    .block-entry:hover { transform: translateX(4px); filter: brightness(.97); }
    .entry-name  { font-weight:700; flex:1; font-size:14px; line-height:1.2; }
    .entry-time  { font-size:13px; font-weight:800; opacity:.8; white-space:nowrap; }
    .entry-check { font-size:15px; flex-shrink:0; opacity:0; transition:opacity .2s; }

    .block-entry.done .entry-name  { text-decoration:line-through; opacity:.4; }
    .block-entry.done .entry-check { opacity:1; }
    .block-entry.done { opacity:.6; }

    .block-entry.banho-entry {
      flex-direction: row;
      align-items: center;
      gap: 8px;
      padding: 7px 10px;
      border-bottom: 1px solid rgba(0,0,0,.06);
      border-radius: 0;
      margin-bottom: 0;
    }
    .banho-entry .entry-name { font-size:14px; font-weight:800; }
    .banho-entry .entry-time { font-size:13px; font-weight:800; opacity:.85; }
    .banho-entry:last-child { border-bottom:none; }

    .block-empty {
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:13px;
      opacity:.28;
      font-style:italic;
    }

    /* â”€â”€â”€ BANHO â”€â”€â”€ */
    .block.banho .block-header { background:var(--banho-h); color:white; }
    .block.banho .block-body   { background:var(--banho-l); color:#1A5570; }
    .block.banho .block-entry  { background:var(--banho-e); }
    .block.banho .banho-entry  { background:transparent; }

    /* â”€â”€â”€ VET â”€â”€â”€ */
    .block.vet .block-header { background:var(--vet-h); color:white; }
    .block.vet .block-body   { background:var(--vet-l); color:#1A4D35; }
    .block.vet .block-entry  { background:var(--vet-e); }
    .block.vet .banho-entry  { background:transparent; }

    /* â”€â”€â”€ ADAPT â”€â”€â”€ */
    .block.adapt .block-header { background:var(--adapt-h); color:white; }
    .block.adapt .block-body   { background:var(--adapt-l); color:#4A2D80; }
    .block.adapt .block-entry  { background:var(--adapt-e); }

    /* â”€â”€â”€ ALERTA ESPECIAL: HÃ³spedes com RestriÃ§Ãµes â”€â”€â”€ */
    @keyframes glowRed {
      0%,100% { box-shadow: 0 0 0 3px #FF1744, 0 6px 32px rgba(220,0,50,.45); }
      50%      { box-shadow: 0 0 0 5px #FF4569, 0 12px 48px rgba(220,0,50,.75); }
    }
    @keyframes headerPulse {
      0%,100% { box-shadow: inset 0 0 0px transparent; }
      50%      { box-shadow: inset 0 0 40px rgba(255,120,120,.25); }
    }
    @keyframes pisca {
      0%,100% { opacity:1;   transform:scale(1);    filter:drop-shadow(0 0 16px rgba(255,0,60,1)); }
      50%      { opacity:.12; transform:scale(1.22); filter:drop-shadow(0 0 4px  rgba(255,0,60,.2)); }
    }
    .block.alerta {
      animation: fadeUp .5s ease forwards, glowRed 1.4s ease-in-out infinite !important;
      border-radius: 18px;
      position: relative;
    }
    .block.alerta .block-header {
      background: linear-gradient(160deg, #B71C1C 0%, #C62828 50%, #B71C1C 100%);
      animation: headerPulse 1.4s ease-in-out infinite;
      color: white;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 2px;
      padding: 14px 18px 12px;
    }
    /* âš ï¸ grande centralizado no topo do header */
    .block.alerta .block-header::before {
      content: 'âš ï¸';
      font-size: 54px;
      line-height: 1;
      display: block;
      animation: pisca .75s ease-in-out infinite;
      margin-bottom: 4px;
    }
    .block.alerta .block-icon  { display: none; } /* substituÃ­do pelo ::before */
    .block.alerta .block-title {
      font-size: 15px;
      font-weight: 900;
      letter-spacing: 1.2px;
      text-align: center;
      line-height: 1.3;
    }
    .block.alerta .block-title::after { display: none; }
    .block.alerta .block-count { font-size: 20px; margin-left: 0; }
    .block.alerta .block-body  { background: #FFF0F0; color: #7B0000; }
    .block.alerta .block-entry { background: rgba(183,28,28,.07); }

    /* â”€â”€â”€ AMARELO â”€â”€â”€ */
    .block.amarelo .block-header { background:var(--ouro-h); color:white; }
    .block.amarelo .block-body   { background:var(--ouro-l); color:#5A4000; }
    .block.amarelo .block-entry  { background:var(--ouro-e); }

    /* â”€â”€â”€ VERDE â”€â”€â”€ */
    .block.verde .block-header { background:var(--verde-h); color:white; }
    .block.verde .block-body   { background:var(--verde-l); color:#1E4D33; }
    .block.verde .block-entry  { background:var(--verde-e); }

    /* â”€â”€â”€ ROSA â”€â”€â”€ */
    .block.rosa .block-header { background:var(--rosa-h); color:white; }
    .block.rosa .block-body   { background:var(--rosa-l); color:#880E4F; }
    .block.rosa .block-entry  { background:var(--rosa-e); }

    /* â”€â”€â”€ FUTURO â”€â”€â”€ */
    .block.futuro .block-header { background:#ddd; color:#999; }
    .block.futuro .block-body   { background:#f5f5f5; }

    /* â•â•â•â• OVERLAY ALARME â•â•â•â• */
    .alarm-overlay {
      display:none;
      position:fixed;
      inset:0;
      z-index:9999;
      background:rgba(176,0,0,.94);
      flex-direction:column;
      align-items:center;
      justify-content:center;
      animation:flash 1s infinite;
      text-align:center;
      padding:40px;
    }
    .alarm-overlay.active { display:flex; }
    .alarm-title  { font-size:60px; font-weight:800; color:white; letter-spacing:3px; margin-bottom:12px; text-shadow:0 4px 14px rgba(0,0,0,.4); }
    .alarm-icon   { font-size:88px; margin-bottom:12px; }
    .alarm-nome   { font-size:44px; font-weight:800; color:white; margin-bottom:6px; }
    .alarm-msg    { font-size:24px; color:rgba(255,255,255,.9); margin-bottom:36px; font-weight:600; }
    .alarm-btn {
      background:white;
      color:#b71c1c;
      border:none;
      padding:14px 44px;
      border-radius:100px;
      font-family:var(--font);
      font-size:20px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 4px 18px rgba(0,0,0,.3);
      transition: transform .15s;
    }
    .alarm-btn:hover { transform: scale(1.05); }

    /* â•â•â•â• LOADING / ERROR â•â•â•â• */
    .loading-box, .error-box {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:80px 40px;
      text-align:center;
      gap:16px;
    }
    .spinner { width:44px; height:44px; border:4px solid #e0dcd4; border-top-color:var(--azul); border-radius:50%; animation:spin 1s linear infinite; }
    .loading-txt { font-size:16px; color:var(--azul); font-weight:700; }
    .error-icon  { font-size:50px; }
    .error-msg   { font-size:16px; color:#c0392b; font-weight:700; }
    .error-tips  { background:#fff8e1; border-radius:12px; padding:14px 18px; font-size:13px; color:#856404; text-align:left; line-height:1.9; max-width:480px; }
    .btn-tentar  { background:var(--azul); color:white; border:none; padding:10px 28px; border-radius:100px; font-family:var(--font); font-size:14px; font-weight:700; cursor:pointer; }

    /* â•â•â•â• FOOTER â•â•â•â• */
    .footer {
      background: var(--azul);
      padding: 9px 28px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }
    .footer-txt   { font-size:11px; color:rgba(255,255,255,.5); font-weight:600; }
    .footer-brand { font-size:12px; color:#F0C840; font-weight:700; letter-spacing:.4px; }

    /* â•â•â•â• RESPONSIVO â€” TABLET â•â•â•â• */
    @media (max-width: 960px) {
      .geral-grid  { grid-template-columns: repeat(2, 1fr); }
      .blocks-grid { grid-template-columns: repeat(2, 1fr); }
      .date-nav .label { min-width: 180px; font-size: 13px; }
    }

    /* â•â•â•â• RESPONSIVO â€” CELULAR â•â•â•â• */
    @media (max-width: 600px) {
      /* Header */
      .header-top  { flex-direction: column; align-items: center; padding: 10px 12px; gap: 4px; }
      .logo-wrap   { height: 72px; }
      .logo-img    { height: 160px; margin-top: -40px; }
      .clock-area  { text-align: center; }
      .clock-dia, .clock-data { text-align: center; }
      .clock-hora  { font-size: 34px; letter-spacing: -2px; }

      /* Frase */
      .frase-strip { padding: 8px 12px; }
      .frase-texto { font-size: 14px; }
      .frase-label { font-size: 10px; letter-spacing: 2px; }

      /* Tabs */
      .tabs-bar { padding: 0 4px; }
      .tab-btn  { padding: 6px 12px; font-size: 12px; }

      /* Barra azul â€” 2 linhas: navegaÃ§Ã£o de data em cima, botÃ£o Atualizar embaixo */
      .status-bar  { flex-direction: column; align-items: stretch; padding: 8px 12px; gap: 6px; }
      .status-left { justify-content: center; }
      .date-nav    { width: 100%; justify-content: center; }
      .date-nav .label { min-width: 0; flex: 1; font-size: 11px; text-align: center; }
      .date-nav button { padding: 5px 10px; font-size: 11px; white-space: nowrap; }
      /* Esconde botÃµes secundÃ¡rios no celular â€” aparecem sÃ³ no PC/tablet */
      .btn-diag    { display: none; }
      .status-timer { display: none; }
      .status-right { justify-content: center; }
      .btn-refresh { padding: 8px 0; font-size: 13px; width: 100%; border-radius: 10px; }

      /* ConteÃºdo */
      .main        { padding: 10px 8px; }
      .geral-grid  { grid-template-columns: repeat(2, 1fr); gap: 8px; }
      .blocks-grid { grid-template-columns: 1fr; gap: 10px; }
      .geral-count { font-size: 44px; }
      .geral-card  { padding: 16px 10px 14px; }
      .block-body  { max-height: 200px; }
      .entry-name  { font-size: 13px; }
      .entry-time  { font-size: 12px; }

      /* Alarme */
      .alarm-title { font-size: 32px; }
      .alarm-icon  { font-size: 60px; }
      .alarm-nome  { font-size: 26px; }
      .alarm-msg   { font-size: 17px; margin-bottom: 20px; }
      .alarm-btn   { font-size: 16px; padding: 12px 28px; }

      /* Footer */
      .footer { padding: 8px 12px; }
      .footer-txt, .footer-brand { font-size: 10px; }
    }
  </style>
</head>
<body>

<!-- â•â•â•â• OVERLAY ALARME â•â•â•â• -->
<div class="alarm-overlay" id="alarm-overlay">
  <div class="alarm-icon" id="alarm-icon-dyn">â°</div>
  <div class="alarm-title">âš ï¸ 5 MINUTOS! âš ï¸</div>
  <div class="alarm-nome" id="alarm-nome">â€”</div>
  <div class="alarm-msg" id="alarm-msg">â€”</div>
  <button class="alarm-btn" onclick="dismissAlarm()">âœ“ Ciente â€” A caminho!</button>
</div>

<!-- â•â•â•â• TABS â€” primeiro, antes do header â•â•â•â• -->
<nav class="tabs-bar">
  <button class="tab-btn" id="tab-geral" onclick="switchTab('geral')">ğŸ“Š VisÃ£o Geral</button>
  <button class="tab-btn ativo" id="tab-rotinas" onclick="switchTab('rotinas')">ğŸ¾ Rotinas Amigos</button>
</nav>

<!-- â•â•â•â• HEADER â•â•â•â• -->
<header class="header">
  <div class="header-top">
    <div class="logo-wrap">
      <img class="logo-img" src="logo.png" alt="ZÃªluz" onerror="this.style.display='none'">
    </div>
    <div class="clock-area">
      <div class="clock-dia"  id="clock-dia">â€”</div>
      <div class="clock-data" id="clock-data">â€”</div>
      <div class="clock-hora" id="clock-hora">â€”:â€”:â€”</div>
      <div id="clock-sync" style="font-size:10px;color:rgba(255,255,255,.5);text-align:right;margin-top:2px;letter-spacing:1px;">â³ Sincronizando...</div>
    </div>
  </div>
</header>

<!-- â•â•â•â• FRASE DO DIA â•â•â•â• -->
<div class="frase-strip">
  <div class="frase-label">âœ¨ Frase do Dia âœ¨</div>
  <div class="frase-texto" id="frase-texto">â€”</div>
</div>

<!-- â•â•â•â• STATUS BAR â•â•â•â• -->
<div class="status-bar">
  <div class="status-left">
    <div class="dot loading" id="status-dot"></div>
    <span class="status-label" id="status-label">Conectando...</span>
  </div>

  <div class="date-nav">
    <button onclick="changeDate(-1)">â† Anterior</button>
    <span class="label" id="date-label">â€”</span>
    <button onclick="changeDate(1)">PrÃ³ximo â†’</button>
    <button class="btn-hoje" onclick="goToToday()">Hoje</button>
  </div>

  <div class="status-right">
    <span class="status-timer" id="status-timer"></span>
    <button class="btn-diag" onclick="verColunas()">ğŸ” DiagnÃ³stico</button>
    <button class="btn-diag" style="background:rgba(255,100,0,.18);border-color:rgba(255,100,0,.4);color:#FF8C00;" onclick="limparCache()">ğŸ—‘ï¸ Limpar Cache</button>
    <button class="btn-diag" style="background:rgba(255,200,0,.18);border-color:rgba(255,200,0,.4);color:#FFD700;" onclick="testarAlarme()">â° Testar Alarme</button>
    <button class="btn-refresh" id="btn-refresh" onclick="manualRefresh()">ğŸ”„ Atualizar</button>
  </div>
</div>

<!-- â•â•â•â• MAIN â•â•â•â• -->
<div class="main">
  <div class="loading-box" id="loading-box">
    <div class="spinner"></div>
    <div class="loading-txt">Carregando dados do DayCare...</div>
  </div>
  <div class="error-box" id="error-box" style="display:none">
    <div class="error-icon">ğŸ“¡</div>
    <div class="error-msg" id="error-msg">NÃ£o foi possÃ­vel carregar os dados.</div>
    <div class="error-tips">
      âœ” Internet conectada?<br>
      âœ” Planilha pÃºblica? (Arquivo â†’ Compartilhar â†’ Qualquer pessoa com link)<br>
      âœ” Nome das abas correto? Ex: "2026 DayCare MarÃ§o"<br>
      âœ” Pressione F5 para recarregar
    </div>
    <button class="btn-tentar" onclick="manualRefresh()">ğŸ”„ Tentar novamente</button>
  </div>

  <div id="content" style="display:none">
    <div class="cache-banner" id="cache-banner">
      ğŸ“¡ Sem internet â€” dados salvos localmente (<span id="cache-time">â€”</span>)
    </div>

    <!-- â•â•â• ABA: VISÃƒO GERAL â•â•â• -->
    <div id="view-geral">
      <div class="geral-topo">
        <div class="geral-titulo">VisÃ£o Geral DayCare</div>
        <div class="geral-subtitulo" id="geral-subtitulo">Tarefas agendadas para o dia</div>
      </div>
      <div class="geral-grid" id="geral-grid"></div>
    </div>

    <!-- â•â•â• ABA: ROTINAS AMIGOS â•â•â• -->
    <div id="view-rotinas" class="ativo">
      <div class="blocks-grid" id="blocks-grid"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â• FOOTER â•â•â•â• -->
<footer class="footer">
  <div class="footer-txt">ğŸ¾ ZÃªluzÂ® â€” Belo Horizonte Â· zeluz.com.br</div>
  <div class="footer-brand">KairÃ³sÂ® â€” By Adriana Duarte .'.</div>
  <div class="footer-txt">Dados salvos no navegador Â· AtualizaÃ§Ã£o: 2 min</div>
</footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CONFIGURAÃ‡ÃƒO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const SHEET_ID   = '1sYJfssdMiUGkyeUX2EUUVpSjpE80kETDT6Gktnqd9kA';
const REFRESH_OK = 120;
const REFRESH_ER = 30;
const CACHE_KEY  = 'zeluz_dc_v3';
const TODO_KEY   = 'zeluz_todo_v1';
const ALARM_KEY  = 'zeluz_alarm_v1';

// â”€â”€â”€ Fontes de alarme: tudo que tem horÃ¡rio â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// parseFromValue:true â†’ o horÃ¡rio estÃ¡ embutido no prÃ³prio valor da coluna ("Kako 17:10")
const ALARM_SOURCES = [
  { nomeCols:['Banho'],                    horaCols:['Hora Banho', 'HorÃ¡rio Banho', 'Horario Banho', 'Hora do Banho'], icon:'ğŸ›', msg:'Prepare para o banho das' },
  { nomeCols:['VeterinÃ¡rio', 'Veterinario', 'Consulta VeterinÃ¡ria', 'Consulta Veterinario'], horaCols:['Hora VeterinÃ¡rio', 'Hora Veterinario', 'HorÃ¡rio VeterinÃ¡rio', 'Horario Veterinario', 'Hora Vet'], icon:'ğŸ©º', msg:'Consulta veterinÃ¡ria Ã s'  },
  { nomeCols:['AvaliaÃ§Ã£o', 'Avaliacao'],   horaCols:['Hora AvaliaÃ§Ã£o', 'Hora Avaliacao', 'HorÃ¡rio', 'Horario'], icon:'ğŸ“‹', msg:'AvaliaÃ§Ã£o Ã s' },
  { nomeCols:['Peludinho que sairÃ¡ cedo', 'Peludinho que saÃ­ra cedo', 'Peludinho que sairÃ¡ mais cedo', 'SaÃ­da Cedo', 'Saida Cedo'], horaCols:['Hora SaÃ­da Cedo', 'Hora Saida Cedo', 'HorÃ¡rio SaÃ­da Cedo', 'Horario Saida Cedo', 'Hora SaÃ­da', 'Hora Saida'], icon:'ğŸš¶', msg:'sai cedo Ã s' },
];
const TZ         = 'America/Sao_Paulo';

const MESES = ['Janeiro','Fevereiro','MarÃ§o','Abril','Maio','Junho',
               'Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
const DIAS  = ['Domingo','Segunda-feira','TerÃ§a-feira','Quarta-feira',
               'Quinta-feira','Sexta-feira','SÃ¡bado'];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  366 FRASES DO DIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const FRASES = [
  // â”€â”€ FILOSÃ“FICAS, INCLUSIVAS & CULTURA ZÃŠLUZ (70) â”€â”€â”€â”€â”€â”€
  "A grandeza de uma naÃ§Ã£o pode ser julgada pelo modo como trata seus peludinhos. â€” Gandhi",
  "Seja a mudanÃ§a que vocÃª quer ver no mundo. â€” Gandhi",
  "Onde hÃ¡ amor, hÃ¡ vida. â€” Gandhi",
  "A vida de um FILHOt nÃ£o Ã© menos valiosa que qualquer outra vida. â€” Gandhi",
  "O que vocÃª faz aos menores, faz a todos. â€” Gandhi",
  "A felicidade Ã© quando o que vocÃª pensa, diz e faz estÃ£o em harmonia. â€” Gandhi",
  "A forÃ§a nÃ£o vem da capacidade fÃ­sica â€” vem da vontade indomÃ¡vel. â€” Gandhi",
  "O bem mais alto Ã© o bem de todos os seres. â€” Gandhi",
  "Todo mundo pode ser grande, porque todo mundo pode servir. â€” Martin Luther King Jr.",
  "A hora sempre foi a hora de agir corretamente. â€” Martin Luther King Jr.",
  "O amor Ã© a Ãºnica forÃ§a capaz de transformar um adversÃ¡rio em amigo. â€” Martin Luther King Jr.",
  "A escuridÃ£o nÃ£o pode expulsar a escuridÃ£o â€” sÃ³ a luz pode. â€” Martin Luther King Jr.",
  "Trate todos os seres com bondade â€” eles tambÃ©m buscam felicidade. â€” Buda",
  "A paz vem de dentro. NÃ£o a procure do lado de fora. â€” Buda",
  "A bondade deve ser tÃ£o natural quanto respirar. â€” Buda",
  "Mil velas podem ser acesas de uma sÃ³ â€” a felicidade nÃ£o diminui ao ser compartilhada. â€” Buda",
  "A compaixÃ£o Ã© o caminho mais curto para a sabedoria. â€” Buda",
  "Cuide de tudo como se fosse Ãºnico â€” porque Ã©. â€” Filosofia zen",
  "O silÃªncio Ã© a lÃ­ngua de quem sabe. â€” ProvÃ©rbio zen",
  "PresenÃ§a total Ã© o maior presente que vocÃª pode oferecer. â€” Filosofia zen",
  "Que seu alimento seja seu remÃ©dio e seu remÃ©dio seja seu alimento. â€” HipÃ³crates",
  "Mente sÃ£ em corpo sÃ£o. â€” HipÃ³crates",
  "Onde hÃ¡ amor pela arte da cura, hÃ¡ amor pela humanidade. â€” HipÃ³crates",
  "A natureza Ã© a melhor mÃ©dica â€” nÃ³s apenas a acompanhamos. â€” HipÃ³crates",
  "A cura Ã© uma questÃ£o de tempo, mas tambÃ©m de oportunidade. â€” HipÃ³crates",
  "A compaixÃ£o Ã© a base de toda moralidade. â€” Schopenhauer",
  "Nenhum ato de bondade, por menor que seja, Ã© desperdiÃ§ado. â€” Esopo",
  "Aquele que salva uma vida, salva um mundo inteiro. â€” Talmude",
  "A beleza estÃ¡ em quem vocÃª se torna ao cuidar. â€” Filosofia",
  "Conhece-te a ti mesmo â€” e ao ser que estÃ¡ sob seu cuidado. â€” SÃ³crates (adapt.)",
  "A paz comeÃ§a com um sorriso. â€” Madre Teresa",
  "NÃ£o podemos fazer grandes coisas â€” apenas pequenas coisas com grande amor. â€” Madre Teresa",
  "Se vocÃª julgar as pessoas, nÃ£o terÃ¡ tempo de amÃ¡-las. â€” Madre Teresa",
  "A Ã©tica do respeito pela vida Ã© a base de toda civilizaÃ§Ã£o. â€” Albert Schweitzer",
  "Enquanto houver um FILHOt precisando de cuidado, nosso coraÃ§Ã£o nÃ£o pode descansar. â€” Albert Schweitzer",
  "Aqui, cada cuidado Ã© ÃšNICO â€” porque cada ser tambÃ©m Ã©. â€” ZÃªluz",
  "Cuidar Ã© escutar o que nÃ£o pode ser dito em palavras.",
  "O amor que vocÃª dÃ¡ sempre encontra seu caminho de volta.",
  "A gentileza custa nada â€” e vale tudo.",
  "Cada cuidado bem feito Ã© uma semente de confianÃ§a plantada.",
  "Cuidar Ã© um ato revolucionÃ¡rio num mundo que vive com pressa.",
  "A empatia nÃ£o escolhe espÃ©cie â€” ela escolhe amor.",
  "PresenÃ§a atenta vale mais que mil instruÃ§Ãµes.",
  "Um ambiente seguro Ã© o primeiro ato de cuidado.",
  "Cada ser vivo merece o melhor de quem cuida dele.",
  "O cansaÃ§o de um dia bem trabalhado Ã© o mais doce repouso.",
  "A dedicaÃ§Ã£o transforma rotina em arte.",
  "Quem serve com alegria transforma o serviÃ§o em missÃ£o.",
  "PropÃ³sito faz a diferenÃ§a entre um trabalho e uma vocaÃ§Ã£o.",
  "Respeitar a vida em todas as formas Ã© o maior ato de sabedoria.",
  "Cuidar sem julgamento Ã© a forma mais pura de amor.",
  "A confianÃ§a se constrÃ³i em cada pequeno gesto.",
  "Ser responsÃ¡vel por outro ser Ã© o mais elevado compromisso.",
  "Nossos peludinhos nÃ£o pedem muito â€” apenas amor e cuidado genuÃ­no.",
  "O silÃªncio de um FILHOt fala mais alto do que qualquer palavra.",
  "Cada peludinho que sai feliz Ã© a nossa maior conquista.",
  "O amor incondicional que um FILHOt oferece merece um cuidado igualmente incondicional.",
  "Cuidar com excelÃªncia Ã© uma forma de honrar a vida.",
  "A saÃºde comeÃ§a na prevenÃ§Ã£o â€” e a prevenÃ§Ã£o comeÃ§a na atenÃ§Ã£o.",
  "O bem-estar do FILHOt reflete o bem-estar de quem cuida.",
  "Tudo que vocÃª sente, os peludinhos tambÃ©m sentem.",
  "Cuidar Ã© um privilÃ©gio â€” tratemos como tal.",
  "Cada ato de cuidado Ã© uma afirmaÃ§Ã£o de que a vida tem valor.",
  "A ternura Ã© a forma mais poderosa de forÃ§a.",
  "Viver Ã© cuidar. Cuidar Ã© viver.",
  "Ser ZÃªluz Ã© escolher a excelÃªncia todos os dias.",
  "Peludinho feliz, tutor satisfeito, ZÃªluz realizada.",
  "ZÃªlo + Luz: cuidar e iluminar cada vida que passa por aqui.",
  "A entrega total Ã© o que transforma o bom em extraordinÃ¡rio.",
  "Quem cuida bem dorme com a consciÃªncia tranquila.",
  "O cuidado genuÃ­no transcende espÃ©cies â€” ele nasce do coraÃ§Ã£o.",

  // â”€â”€ FUTEBOL (70) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "CampeÃ£o nÃ£o erra menos â€” levanta mais rÃ¡pido.",
  "Time que nÃ£o treina junto, nÃ£o vence junto.",
  "O gol mais importante Ã© o prÃ³ximo.",
  "Cada treino Ã© um passo rumo ao campeonato.",
  "Nenhum campeÃ£o nasceu pronto.",
  "Bola na rede comeÃ§a no treino.",
  "Talento sem dedicaÃ§Ã£o Ã© reserva.",
  "Quem quer jogar bem, treina quando ninguÃ©m vÃª.",
  "Cada jogador faz parte do time â€” e o time faz cada jogador.",
  "O futebol ensina: vocÃª pode perder um jogo, mas nÃ£o a garra.",
  "Time que respira junto, vence junto.",
  "Em futebol, quem para de correr, para de jogar.",
  "Garra nÃ£o se treina â€” se cultiva.",
  "O melhor jogador Ã© aquele que faz o time jogar.",
  "PÃªnalti exige coragem. A vida tambÃ©m.",
  "Reserva que treina como titular, um dia vira titular.",
  "O intervalo Ã© para planejar, nÃ£o para descansar.",
  "Ganhar sem dificuldade Ã© vencer sem glÃ³ria.",
  "O capitÃ£o nÃ£o grita mais â€” inspira mais.",
  "Em campo e na vida: foco, garra e entrega total.",
  "Quem nÃ£o arrisca o passe, nunca faz o gol.",
  "O maior gol Ã© o que vem depois de muitos erros.",
  "Defesa sÃ³lida Ã© a base de todo campeonato.",
  "O futebol ensina que o coletivo sempre supera o individual.",
  "Quem abaixa a cabeÃ§a no primeiro gol, jÃ¡ perdeu.",
  "Corra mais do que ontem. Descanse menos do que amanhÃ£.",
  "A bola sempre acha o jogador que mais se movimenta.",
  "No futebol da vida: regule o passo, mas nunca pare.",
  "NÃ£o Ã© a camisa que honra o time â€” Ã© quem a veste.",
  "Perde-se uma partida, aprende-se uma liÃ§Ã£o.",
  "Gol de bicicleta comeÃ§a com queda nos treinos.",
  "O que separa o bom do excelente? Os Ãºltimos 10 minutos.",
  "Estrela nÃ£o joga sozinha â€” passa a bola.",
  "Aqui, como no futebol: cada cuidado conta.",
  "NÃ£o existe atalho para o pÃ³dio.",
  "Jogar bonito Ã© consequÃªncia de treinar bem.",
  "O melhor time Ã© aquele que todos querem estar.",
  "EstratÃ©gia vence talento quando o talento nÃ£o tem estratÃ©gia.",
  "O futebol nÃ£o espera â€” e o sucesso tambÃ©m nÃ£o.",
  "CampeÃµes sÃ£o definidos nos momentos em que querem desistir.",
  "Em futebol e na vida: a vitÃ³ria Ã© de todos.",
  "Treino duro, jogo fÃ¡cil.",
  "O que vale nÃ£o Ã© quem comeÃ§ou â€” Ã© quem terminou.",
  "O campeonato Ã© longo. Cuide do seu time.",
  "No futebol, como aqui: todos importam.",
  "Gol nÃ£o Ã© sorte â€” Ã© horas de dedicaÃ§Ã£o.",
  "A bola Ã© redonda, mas o esforÃ§o Ã© reto.",
  "Quem nÃ£o acredita no time, jÃ¡ perdeu antes de jogar.",
  "O melhor treino Ã© o que vocÃª faz quando estÃ¡ cansado.",
  "O melhor jogador nÃ£o Ã© o mais rÃ¡pido â€” Ã© o mais inteligente.",
  "A concentraÃ§Ã£o no segundo tempo decide o jogo.",
  "Treinador que ouve o jogador, constrÃ³i time.",
  "Na prorrogaÃ§Ã£o, vence quem tem mais fÃ´lego mental.",
  "Bom posicionamento vale mais que velocidade.",
  "Copa nÃ£o se ganha com talento â€” se ganha com coletivo.",
  "A preparaÃ§Ã£o prÃ©-jogo Ã© onde a vitÃ³ria comeÃ§a.",
  "Um time bem treinado Ã© uma mÃ¡quina de vitÃ³rias.",
  "Quem respeita o adversÃ¡rio, respeita a si mesmo.",
  "Copa do mundo se ganha no detalhe â€” assim como o cuidado.",
  "A torcida energiza, mas a equipe decide.",
  "Segundo lugar treina mais duro para ser primeiro.",
  "O gol mais difÃ­cil Ã© o de empate nos Ãºltimos minutos.",
  "Dentro de campo, cada segundo conta.",
  "O time que corre mais no segundo tempo vence.",
  "Jogo bonito comeÃ§a no respeito entre os jogadores.",
  "Quem ama o futebol, ama cada treino.",
  "O placar muda, mas o carÃ¡ter nÃ£o.",
  "Seja o jogador que o time precisa â€” nÃ£o o que vocÃª quer ser.",
  "Disciplina de atleta, coraÃ§Ã£o de campeÃ£o.",
  "Cada erro de ontem Ã© treino para o gol de amanhÃ£.",

  // â”€â”€ CULTURA ZÃŠLUZ (70) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "Cada FILHOt Ã© Ãºnico. Cada cuidado tambÃ©m.",
  "PrevenÃ§Ã£o hoje, longevidade amanhÃ£.",
  "Quem cuida com amor nunca estÃ¡ trabalhando.",
  "A excelÃªncia nÃ£o Ã© um ato â€” Ã© um hÃ¡bito.",
  "Cuidar bem Ã© a nossa maior entrega.",
  "O pelo tem funÃ§Ã£o. NÃ³s respeitamos.",
  "SaÃºde comeÃ§a no prato.",
  "Cada banho Ã© uma declaraÃ§Ã£o de amor.",
  "Bem-estar nÃ£o Ã© luxo â€” Ã© necessidade.",
  "O FILHOt nÃ£o fala, mas sente tudo.",
  "PrevenÃ§Ã£o Ã© o maior ato de amor.",
  "Aqui, brincar Ã© cuidar.",
  "FamÃ­lia multiespÃ©cie merece o melhor.",
  "Cuidar Ã© um privilÃ©gio.",
  "A longevidade comeÃ§a no cuidado diÃ¡rio.",
  "O amor que o tutor sente, a ZÃªluz transforma em cuidado.",
  "Cada visita Ã© Ãºnica. Cada FILHOt, tambÃ©m.",
  "Cuide do pelo para cuidar da pele.",
  "DermoproteÃ§Ã£o Ã© saÃºde, nÃ£o estÃ©tica.",
  "Enriquecimento ambiental Ã© saÃºde mental do FILHOt.",
  "A gente nÃ£o lava â€” a gente cuida.",
  "AlimentaÃ§Ã£o natural Ã© combustÃ­vel de qualidade.",
  "NÃ£o somos petshop â€” somos ecossistema de bem-estar.",
  "A AuaulÃ¢ndia Ã© uma segunda casa â€” nÃ£o um depÃ³sito.",
  "SaÃºde de dentro para fora.",
  "Cuidar Ã© escutar o que o FILHOt nÃ£o consegue dizer.",
  "O tutor fica tranquilo quando confia.",
  "A tosa certa protege â€” a errada expÃµe.",
  "A felicidade do FILHOt Ã© a nossa meta.",
  "Sete anos cuidando com excelÃªncia.",
  "O FILHOt sente quando Ã© tratado com amor.",
  "Bem-estar + SaÃºde + Longevidade. O tripÃ© de tudo.",
  "Conhecimento tÃ©cnico a serviÃ§o do amor pelo FILHOt.",
  "O carinho faz parte do protocolo.",
  "Cada coleira trocada Ã© um detalhe que importa.",
  "VermÃ­fugo em dia, FILHOt saudÃ¡vel sempre.",
  "AdaptaÃ§Ã£o cuidadosa, FILHOt confiante.",
  "O tutor que previne, nÃ£o lamenta depois.",
  "Carinho + TÃ©cnica + ExcelÃªncia = ZÃªluz.",
  "Cada avaliaÃ§Ã£o nos permite cuidar melhor.",
  "A hidrataÃ§Ã£o das patinhas comeÃ§a com quem cuida bem.",
  "O cliente novo de hoje Ã© o parceiro de anos amanhÃ£.",
  "A crianÃ§a nÃ£o escolhe. O FILHOt tambÃ©m nÃ£o. Escolha por ele.",
  "Quando o FILHOt entra bem e sai melhor â€” fizemos nosso trabalho.",
  "O cuidado que nÃ£o aparece na foto Ã© o que mais importa.",
  "ExcelÃªncia silenciosa Ã© a nossa assinatura.",
  "Cada aniversariante merece um dia especial.",
  "Cuidar cedo Ã© voar alto depois.",
  "PrevenÃ§Ã£o: o que nÃ£o se vÃª, mas transforma tudo.",
  "A ZÃªluz nÃ£o terceiriza o cuidado â€” o internaliza.",
  "Cada ingrediente natural Ã© um investimento na longevidade.",
  "Cada membro da equipe Ã© a ZÃªluz para o cliente.",
  "A qualidade do dia comeÃ§a na preparaÃ§Ã£o da manhÃ£.",
  "PadrÃ£o alto nÃ£o Ã© exigÃªncia â€” Ã© respeito.",
  "Rotina bem feita Ã© o segredo dos grandes.",
  "O detalhe que o cliente nÃ£o vÃª, a equipe nÃ£o pode ignorar.",
  "CritÃ©rio mantido Ã© confianÃ§a construÃ­da.",
  "O sorriso do cliente Ã© o melhor retorno.",
  "Cada FILHOt que sai feliz Ã© a nossa propaganda.",
  "Serve bem para crescer rÃ¡pido.",
  "A confianÃ§a do cliente Ã© conquistada, nÃ£o dada.",
  "Trate cada FILHOt como se fosse o Ãºnico da semana.",
  "O amor ao FILHOt reflete no cuidado da equipe.",
  "Cuidado premium nÃ£o Ã© sobre preÃ§o â€” Ã© sobre valor.",
  "Cada dia aqui Ã© um dia de bem-estar para algum FILHOt.",
  "O segredo da longevidade do FILHOt? PrevenÃ§Ã£o e amor.",
  "Ser ZÃªluz Ã© escolher a excelÃªncia todos os dias.",
  "Peludinho feliz, tutor satisfeito, ZÃªluz realizada.",
  "Aqui, cada cuidado Ã© ÃšNICO â€” hoje e sempre.",

  // â”€â”€ MOTIVACIONAL E LIDERANÃ‡A (96) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "Liderar Ã© servir.",
  "A equipe forte comeÃ§a no respeito individual.",
  "Quem motiva a equipe motiva o resultado.",
  "Cultura forte Ã© o maior ativo de um negÃ³cio.",
  "Feedback dado com cuidado Ã© presente, nÃ£o puniÃ§Ã£o.",
  "Equipe que celebra junta, cresce junta.",
  "O lÃ­der que escuta Ã© o que mais aprende.",
  "ExcelÃªncia Ã© um padrÃ£o coletivo, nÃ£o individual.",
  "Quem cuida da equipe, a equipe cuida do resultado.",
  "O melhor dia de trabalho comeÃ§a com propÃ³sito.",
  "PropÃ³sito compartilhado multiplica esforÃ§o.",
  "Reconhecer Ã© tÃ£o importante quanto cobrar.",
  "A confianÃ§a Ã© construÃ­da em cada entrega pequena.",
  "Resultado sustentÃ¡vel vem de cultura sustentÃ¡vel.",
  "Equipe alinhada Ã© equipe que entrega.",
  "Um sorriso no atendimento comeÃ§a no bastidor.",
  "Time que se respeita, entrega mais.",
  "ComunicaÃ§Ã£o clara evita retrabalho.",
  "Quando a equipe vence, todos vencem.",
  "Humildade Ã© a base de todo aprendizado.",
  "O que vocÃª faz quando ninguÃ©m vÃª define quem vocÃª Ã©.",
  "ConsistÃªncia bate talento quando o talento Ã© inconsistente.",
  "A disciplina hoje Ã© a liberdade amanhÃ£.",
  "Seja o padrÃ£o que vocÃª quer ver na equipe.",
  "Pequenas melhorias diÃ¡rias criam grandes resultados.",
  "Quem nÃ£o cresce, emperra.",
  "A energia que vocÃª traz contagia.",
  "Cuide do ambiente â€” ele cuida dos resultados.",
  "Comprometimento Ã© a diferenÃ§a entre o bom e o excelente.",
  "InovaÃ§Ã£o comeÃ§a com quem ousa questionar o status quo.",
  "Cada dia Ã© uma nova chance de ser melhor.",
  "Orgulho de pertencer comeÃ§a em como somos tratados.",
  "O respeito mÃºtuo Ã© o fundamento de tudo.",
  "Quando o propÃ³sito Ã© claro, o sacrifÃ­cio faz sentido.",
  "Resultados extraordinÃ¡rios exigem compromissos ordinÃ¡rios cumpridos.",
  "Foque no processo â€” os resultados vÃªm depois.",
  "Sua atitude de hoje Ã© o seu resultado de amanhÃ£.",
  "Quem planta com excelÃªncia, colhe com abundÃ¢ncia.",
  "Quem comeÃ§a antes chega antes.",
  "O medo Ã© o maior inimigo do crescimento.",
  "Cada dia Ã© uma folha em branco â€” escreva algo bonito.",
  "O esforÃ§o de hoje Ã© o orgulho de amanhÃ£.",
  "Pequenos passos constantes vencem grandes passos esporÃ¡dicos.",
  "NÃ£o espere a motivaÃ§Ã£o â€” crie o hÃ¡bito.",
  "O que vocÃª faz hoje molda quem vocÃª serÃ¡ amanhÃ£.",
  "DÃª o melhor de si mesmo â€” sempre vale a pena.",
  "Sonho sem aÃ§Ã£o Ã© ilusÃ£o. AÃ§Ã£o sem sonho Ã© rotina.",
  "A mudanÃ§a comeÃ§a na decisÃ£o.",
  "A gratidÃ£o Ã© o combustÃ­vel da alegria.",
  "Quem faz com amor, faz com excelÃªncia.",
  "Cada obstÃ¡culo tem uma liÃ§Ã£o dentro.",
  "Sucesso Ã© a soma dos pequenos esforÃ§os repetidos dia apÃ³s dia.",
  "Disciplina Ã© escolher o que vocÃª quer mais pelo que quer agora.",
  "Seja a versÃ£o de vocÃª que seu futuro agradece.",
  "A persistÃªncia realiza o que o talento nÃ£o consegue sozinho.",
  "Cada detalhe tem um dono responsÃ¡vel â€” seja esse dono.",
  "FaÃ§a hoje o que os outros deixam para amanhÃ£.",
  "A competÃªncia cresce com a prÃ¡tica deliberada.",
  "Quem aprecia o processo, celebra os resultados.",
  "Seja o motivo do sorriso de alguÃ©m hoje.",
  "PropÃ³sito maior que o desafio â€” sempre.",
  "Cada conquista comeÃ§a com a decisÃ£o de tentar.",
  "Errar faz parte â€” desistir, nÃ£o.",
  "A excelÃªncia nÃ£o cansa â€” o descuido sim.",
  "VocÃª Ã© a soma dos hÃ¡bitos que cultiva.",
  "Hoje Ã© um bom dia para fazer o bem.",
  "Seja consistente e os resultados serÃ£o inevitÃ¡veis.",
  "A melhoria comeÃ§a quando a desculpa termina.",
  "FaÃ§a o que precisa ser feito, quando precisa ser feito.",
  "A qualidade do trabalho Ã© a sua assinatura.",
  "Grandes resultados comeÃ§am em decisÃµes pequenas.",
  "Seja o profissional que vocÃª gostaria de encontrar.",
  "A vitÃ³ria pertence a quem mais resistiu.",
  "Quem investe em relacionamento, investe no futuro.",
  "O talento se mostra nos momentos difÃ­ceis.",
  "Seja inteiro em tudo que vocÃª faz.",
  "O crescimento acontece fora da zona de conforto.",
  "Nada substitui a entrega com amor.",
  "A responsabilidade Ã© o preÃ§o da excelÃªncia.",
  "Quem melhora todo dia, transforma tudo em um ano.",
  "Fazer bem feito sempre foi e sempre serÃ¡ o caminho.",
  "Seja alguÃ©m que vale a pena lembrar.",
  "O trabalho bem feito honra a quem o realiza.",
  "Novo dia, nova oportunidade de superar a si mesmo.",
  "A vida Ã© curta demais para nÃ£o fazer o que ama.",
  "Cuide hoje como se fosse a Ãºltima oportunidade.",
  "GratidÃ£o pelo dia de trabalho que estÃ¡ comeÃ§ando.",
  "Mais um dia, mais um motivo para ser excelente.",
  "A ZÃªluz existe por amor â€” e assim continuarÃ¡.",
  "Cada membro da equipe Ã© parte da histÃ³ria da ZÃªluz.",
  "Qualidade nÃ£o Ã© negociÃ¡vel.",
  "O que diferencia Ã© a entrega, nÃ£o sÃ³ o talento.",
  "Hoje Ã© o primeiro dia do resto da sua histÃ³ria.",
  "A vitÃ³ria tem sabor de sacrifÃ­cio.",
  "O sucesso nÃ£o Ã© o destino â€” Ã© o caminho.",
  "Seu legado Ã© o que fica quando vocÃª vai embora.",
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DEFINIÃ‡ÃƒO DOS BLOCOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PRIMARY_NAME_COLUMNS = ['Aulunos', 'Alunos', 'Aluno', 'Nome', 'Nomes', 'Peludinho', 'Peludinhos', 'Matriculados'];

function makeBlock(config) {
  const block = {
    ...config,
    cols: [...new Set((config.cols || []).filter(Boolean))],
    timeCols: [...new Set((config.timeCols || []).filter(Boolean))],
    useNameOr: config.useNameOr !== false,
  };
  block.fn = rows => buildEntriesFromColumns(rows, block.cols, block.timeCols, { useNameOr: block.useNameOr });
  return block;
}

const BASE_BLOCKS = [
  makeBlock({
    id:'restricao',
    title:'HÃ³spedes com RestriÃ§Ãµes',
    icon:'ğŸ âš ï¸',
    color:'alerta',
    cols:['HÃ³spedes com RestriÃ§Ãµes', 'Hospedes com Restricoes', 'HÃ³spedes com RestriÃ§Ã£o', 'Hospedes com Restricao'],
    useNameOr:false,
  }),
  makeBlock({
    id:'banho',
    title:'Banho',
    icon:'ğŸ›',
    color:'banho',
    special:'banho',
    cols:['Banho'],
    timeCols:['Hora Banho', 'HorÃ¡rio Banho', 'Horario Banho', 'Hora do Banho'],
    useNameOr:false,
  }),
  makeBlock({
    id:'vet',
    title:'VeterinÃ¡rio',
    icon:'ğŸ©º',
    color:'vet',
    special:'banho',
    cols:['VeterinÃ¡rio', 'Veterinario', 'Consulta VeterinÃ¡ria', 'Consulta Veterinario'],
    timeCols:['Hora VeterinÃ¡rio', 'Hora Veterinario', 'HorÃ¡rio VeterinÃ¡rio', 'Horario Veterinario', 'Hora Vet'],
    useNameOr:false,
  }),
  makeBlock({
    id:'saindo',
    title:'Peludinho que SairÃ¡ Cedo',
    icon:'ğŸš¶',
    color:'amarelo',
    cols:['Peludinho que sairÃ¡ cedo', 'Peludinho que saÃ­ra cedo', 'Peludinho que sairÃ¡ mais cedo', 'SaÃ­da Cedo', 'Saida Cedo'],
    timeCols:['Hora SaÃ­da Cedo', 'Hora Saida Cedo', 'HorÃ¡rio SaÃ­da Cedo', 'Horario Saida Cedo', 'Hora SaÃ­da', 'Hora Saida'],
    useNameOr:false,
  }),
  makeBlock({
    id:'vermifugo',
    title:'VermÃ­fugo',
    icon:'ğŸ’Š',
    color:'vet',
    cols:['VermÃ­fugo', 'Vermifugo'],
  }),
  makeBlock({
    id:'carrap',
    title:'Carrapaticida',
    icon:'ğŸ”¬',
    color:'vet',
    cols:['Carrapaticida'],
  }),
  makeBlock({
    id:'coleira',
    title:'Troca de Coleira',
    icon:'ğŸ·ï¸',
    color:'vet',
    cols:['Troca de Coleira'],
  }),
  makeBlock({
    id:'hidrat',
    title:'HidrataÃ§Ã£o Patinha e Focinho',
    icon:'ğŸ’§',
    color:'banho',
    cols:['HidrataÃ§Ã£o patinha e Focinho', 'Hidratacao patinha e Focinho', 'HidrataÃ§Ã£o Patinha e Focinho', 'Hidratacao Patinha e Focinho', 'HidrataÃ§Ã£o de Patinha e Focinho', 'Hidratacao de Patinha e Focinho'],
  }),
  makeBlock({
    id:'avulso',
    title:'Avulso',
    icon:'ğŸ“Œ',
    color:'amarelo',
    cols:['Avulso'],
  }),
  makeBlock({
    id:'aval',
    title:'AvaliaÃ§Ã£o',
    icon:'ğŸ“‹',
    color:'amarelo',
    cols:['AvaliaÃ§Ã£o', 'Avaliacao'],
    timeCols:['Hora AvaliaÃ§Ã£o', 'Hora Avaliacao', 'HorÃ¡rio', 'Horario'],
  }),
  makeBlock({
    id:'novo',
    title:'Cliente Novo',
    icon:'â­',
    color:'adapt',
    cols:['Cliente Novo', 'Cliente novo', 'Novo Cliente'],
  }),
  makeBlock({
    id:'adapt',
    title:'AdaptaÃ§Ã£o',
    icon:'ğŸŒŸ',
    color:'adapt',
    cols:['AdaptaÃ§Ã£o', 'Adaptacao'],
  }),
  makeBlock({
    id:'repos',
    title:'ReposiÃ§Ã£o',
    icon:'ğŸ”„',
    color:'amarelo',
    cols:['ReposiÃ§Ã£o', 'Reposicao'],
  }),
  makeBlock({
    id:'faltas',
    title:'Faltas Avisadas',
    icon:'âš ï¸',
    color:'amarelo',
    cols:['Faltas Avisadas', 'Falta Avisada', 'Faltas'],
  }),
  makeBlock({
    id:'aniver',
    title:'AUniversariante',
    icon:'ğŸ‚',
    color:'rosa',
    cols:['AUniversariante', 'Aniversariante', 'AniversÃ¡rio', 'Aniversario'],
    useNameOr:false,
  }),
  makeBlock({
    id:'outros',
    title:'Outros',
    icon:'ğŸ“',
    color:'amarelo',
    cols:['Outros', 'ObservaÃ§Ãµes', 'Observacoes', 'Obs'],
    useNameOr:false,
  }),
  makeBlock({
    id:'outros2',
    title:'Outros 2',
    icon:'ğŸ“',
    color:'amarelo',
    cols:['Outros 2', 'Outros2', 'ObservaÃ§Ãµes 2', 'Observacoes 2', 'Obs 2'],
    useNameOr:false,
  }),
];

const FUTURE_BLOCK = { id:'fut4', title:'Em Breve', icon:'â•', color:'futuro', fn:()=>[] };

// helpers â€” busca coluna tolerando acento, espacos especiais e pequenas variacoes
const _strip = s => String(s ?? '').normalize('NFD').replace(/[\u0300-\u036f]/g,'');
const _norm  = s => _strip(String(s ?? '').replace(/\u00A0/g, ' '))
  .replace(/[^a-zA-Z0-9\s]/g, ' ')
  .replace(/\s+/g, ' ')
  .trim()
  .toLowerCase();
const pad2   = x => String(x).padStart(2,'0');
const KNOWN_COLUMN_KEYS = new Set([
  'Data',
  ...PRIMARY_NAME_COLUMNS,
  ...BASE_BLOCKS.flatMap(block => [...block.cols, ...block.timeCols]),
  ...ALARM_SOURCES.flatMap(src => [...src.nomeCols, ...src.horaCols]),
].map(_norm));
const PRIMARY_NAME_KEY_SET = new Set(PRIMARY_NAME_COLUMNS.map(_norm));

function findColKey(row, key) {
  const wanted = _norm(key);
  return Object.keys(row).find(rk => _norm(rk) === wanted) || null;
}

function orderedUniqueRowKeys(row) {
  const seen = new Set();
  return Object.keys(row).filter(key => {
    const norm = _norm(key);
    if(!norm || seen.has(norm)) return false;
    seen.add(norm);
    return true;
  });
}

function v(r, k) {
  const directKeys = [k, `${k}`, `${k} `, k && k.normalize ? k.normalize('NFC') : k, _strip(k)];
  for(const dk of directKeys) {
    if(dk != null && Object.prototype.hasOwnProperty.call(r, dk)) {
      const value = String(r[dk] ?? '').trim();
      if(value !== '') return value;
    }
  }
  const match = findColKey(r, k);
  return match ? String(r[match] ?? '').trim() : '';
}

function vAny(r, keys) {
  for(const key of keys) {
    const value = v(r, key);
    if(value !== '') return value;
  }
  return '';
}

function hasAny(r, keys) {
  return keys.some(key => has(r, key));
}

function has(r, k) {
  const x = v(r, k);
  return x !== '' && !isFalseFlag(x);
}

function isTrueFlag(value) {
  const norm = _norm(value);
  return norm === '1' || norm === 'sim' || norm === 'true' || norm === 'x' || norm === 'ok' || norm === 'yes' || norm === 'y';
}

function isFalseFlag(value) {
  const norm = _norm(value);
  return norm === '' || norm === '0' || norm === 'nao' || norm === 'false' || norm === 'no' || norm === 'n';
}

function looksLikeTimeText(value) {
  return !!parseHora(value);
}

function isMeaningfulNameValue(value) {
  const raw = String(value ?? '').trim();
  if(raw === '' || isTrueFlag(raw) || isFalseFlag(raw)) return false;
  if(looksLikeTimeText(raw)) return false;
  if(/^\d+(?:[.,]\d+)?$/.test(raw)) return false;
  return true;
}

function primaryNameSourceColumns(allColumns) {
  const cols = Array.isArray(allColumns) ? allColumns : [];
  const result = [];
  const seen = new Set();
  const push = value => {
    const text = String(value ?? '').trim();
    const norm = _norm(text);
    if(!norm || seen.has(norm)) return;
    seen.add(norm);
    result.push(text);
  };

  PRIMARY_NAME_COLUMNS.forEach(push);

  cols.forEach(col => {
    const norm = _norm(col);
    if(/(^| )nome(s)?($| )/.test(norm) || norm.includes('aluno') || norm.includes('matriculad') || norm.includes('peludinho')) {
      push(col);
    }
  });

  const dataIndex = cols.findIndex(col => _norm(col) === 'data');
  if(dataIndex > 0) push(cols[dataIndex - 1]);

  return result;
}

function rowPrimaryNameSourceKey(row) {
  const orderedKeys = orderedUniqueRowKeys(row);
  const dataIndex = orderedKeys.findIndex(key => _norm(key) === 'data');
  return dataIndex > 0 ? orderedKeys[dataIndex - 1] : '';
}

function primaryNameSourceColumnsFromRows(rows) {
  const seen = new Set();
  const result = [];
  const push = value => {
    const text = String(value ?? '').trim();
    const norm = _norm(text);
    if(!norm || seen.has(norm)) return;
    seen.add(norm);
    result.push(text);
  };

  primaryNameSourceColumns(collectDisplayColumns(rows)).forEach(push);
  rows.forEach(row => push(rowPrimaryNameSourceKey(row)));
  return result;
}

function primaryRowName(r) {
  const orderedKeys = orderedUniqueRowKeys(r);
  const candidates = [...new Set([
    ...primaryNameSourceColumns(orderedKeys),
    rowPrimaryNameSourceKey(r),
  ].filter(Boolean))];
  for(const key of candidates) {
    const value = v(r, key);
    if(isMeaningfulNameValue(value)) return value;
  }
  return '';
}

function nameOrValue(value, row) {
  if(value === '') return '';
  return isTrueFlag(value) ? primaryRowName(row) : value;
}

function nameOr(r, k) {
  const x = v(r, k);
  if(x === '') return '';
  return nameOrValue(x, r);
}

function nameOrAny(r, keys) {
  for(const key of keys) {
    const value = v(r, key);
    if(value !== '') return nameOrValue(value, r);
  }
  return '';
}

function buildEntriesFromColumns(rows, cols, timeCols = [], { useNameOr = true } = {}) {
  return rows.map(row => {
    const mainValue = vAny(row, cols);
    if(mainValue === '') return null;
    const name = useNameOr ? nameOrAny(row, cols) : mainValue;
    if(name === '') return null;
    return { name, time: vAny(row, timeCols) };
  }).filter(Boolean);
}

function collectDisplayColumns(rows) {
  const seen = new Set();
  const columns = [];
  rows.forEach(row => {
    orderedUniqueRowKeys(row).forEach(key => {
      const norm = _norm(key);
      if(!norm || seen.has(norm)) return;
      seen.add(norm);
      columns.push(String(key).trim());
    });
  });
  return columns;
}

function dynamicTimeColumnsFor(label, allColumns) {
  const byNorm = new Map(allColumns.map(col => [_norm(col), col]));
  const candidates = [
    `Hora ${label}`,
    `HorÃ¡rio ${label}`,
    `Horario ${label}`,
    `${label} HorÃ¡rio`,
    `${label} Horario`,
  ];
  return [...new Set(candidates.map(candidate => byNorm.get(_norm(candidate))).filter(Boolean))];
}

function isPairedTimeOnlyColumn(label, allColumns) {
  const raw = String(label ?? '').trim();
  const looksLikeTimeColumn = /^\s*Hora\s+/i.test(raw)
    || /^\s*Hor[Ã¡a]rio\s+/i.test(raw)
    || /\s+Hor[Ã¡a]rio\s*$/i.test(raw)
    || /\s+Hora\s*$/i.test(raw);
  if(!looksLikeTimeColumn) return false;

  const baseCandidates = [
    raw.replace(/^\s*Hora\s+/i, ''),
    raw.replace(/^\s*Hor[Ã¡a]rio\s+/i, ''),
    raw.replace(/\s+Hor[Ã¡a]rio\s*$/i, ''),
    raw.replace(/\s+Hora\s*$/i, ''),
  ].map(candidate => candidate.trim()).filter(Boolean);

  return baseCandidates.some(candidate => {
    const wanted = _norm(candidate);
    return wanted && allColumns.some(col => _norm(col) === wanted);
  });
}

function guessBlockIcon(label) {
  const norm = _norm(label);
  if(norm.includes('banho')) return 'ğŸ›';
  if(norm.includes('veterin') || norm.includes('vet')) return 'ğŸ©º';
  if(norm.includes('verm')) return 'ğŸ’Š';
  if(norm.includes('carrap')) return 'ğŸ”¬';
  if(norm.includes('coleira')) return 'ğŸ·ï¸';
  if(norm.includes('hidrata')) return 'ğŸ’§';
  if(norm.includes('adapt')) return 'ğŸŒŸ';
  if(norm.includes('cliente novo') || norm.includes('novo cliente')) return 'â­';
  if(norm.includes('aniver')) return 'ğŸ‚';
  if(norm.includes('restri')) return 'ğŸ âš ï¸';
  if(norm.includes('repos')) return 'ğŸ”„';
  if(norm.includes('falta')) return 'âš ï¸';
  if(norm.includes('saida') || norm.includes('saira cedo')) return 'ğŸš¶';
  if(norm.includes('hora') || norm.includes('horario')) return 'â°';
  return 'ğŸ“';
}

function guessBlockColor(label) {
  const norm = _norm(label);
  if(norm.includes('banho') || norm.includes('hidrata')) return 'banho';
  if(norm.includes('veterin') || norm.includes('vet') || norm.includes('verm') || norm.includes('carrap') || norm.includes('coleira')) return 'vet';
  if(norm.includes('adapt') || norm.includes('cliente novo') || norm.includes('novo cliente')) return 'adapt';
  if(norm.includes('aniver')) return 'rosa';
  if(norm.includes('restri')) return 'alerta';
  return 'amarelo';
}

function slugify(text) {
  return (_norm(text).replace(/\s+/g, '-') || 'coluna-extra');
}

function buildDynamicBlocks(rows) {
  const allColumns = collectDisplayColumns(rows);
  const primarySourceSet = new Set(primaryNameSourceColumnsFromRows(rows).map(_norm));
  return allColumns
    .filter(label => {
      const norm = _norm(label);
      if(!norm || KNOWN_COLUMN_KEYS.has(norm) || PRIMARY_NAME_KEY_SET.has(norm)) return false;
      if(primarySourceSet.has(norm)) return false;
      if(isPairedTimeOnlyColumn(label, allColumns)) return false;
      return true;
    })
    .sort((a, b) => a.localeCompare(b, 'pt-BR'))
    .map(label => makeBlock({
      id:`dyn-${slugify(label)}`,
      title:label,
      icon:guessBlockIcon(label),
      color:guessBlockColor(label),
      cols:[label],
      timeCols:dynamicTimeColumnsFor(label, allColumns),
    }));
}

function getRenderableBlocks(rows) {
  return [...BASE_BLOCKS, ...buildDynamicBlocks(rows), FUTURE_BLOCK];
}

function formatDateParts(day, month, year) {
  return `${pad2(day)}/${pad2(month)}/${year}`;
}

function normalizeDateValue(value) {
  const raw = String(value ?? '').replace(/\u00A0/g, ' ').trim();
  if(!raw) return '';

  let match = raw.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2,4})(?:\s+.*)?$/);
  if(match) {
    let year = +match[3];
    if(year < 100) year += 2000;
    return formatDateParts(+match[1], +match[2], year);
  }

  match = raw.match(/^(\d{4})[\/\-](\d{1,2})[\/\-](\d{1,2})(?:[ T].*)?$/);
  if(match) return formatDateParts(+match[3], +match[2], +match[1]);

  return raw;
}

function selectedDateStr() {
  return formatDateParts(selectedDate.getDate(), selectedDate.getMonth()+1, selectedDate.getFullYear());
}

function rowDateStr(row) {
  return normalizeDateValue(v(row, 'Data'));
}

function rowsForSelectedDate(allRows) {
  const dateStr = selectedDateStr();
  return allRows.filter(row => rowDateStr(row) === dateStr);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ESTADO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let selectedDate = new Date();
const mem = {};
let lastOk=null, countdown=REFRESH_OK, loading=false, status='ok';
let alarmActive = false;
let activeTab = 'rotinas';
let followToday = true;
let brasiliaTodayKey = '';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function init() {
  syncSelectedDateWithToday(true);
  setFraseDia();
  syncInternetTime();                          // sincroniza na abertura
  setInterval(syncInternetTime, 30*60*1000);  // ressincroniza a cada 30 min
  updateClock();
  setInterval(updateClock, 1000);
  setInterval(tick, 1000);
  setInterval(checkAlarm, 10000);
  switchTab('rotinas');
  loadData();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TROCA DE ABA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(tab) {
  activeTab = tab;
  document.getElementById('tab-geral').classList.toggle('ativo', tab === 'geral');
  document.getElementById('tab-rotinas').classList.toggle('ativo', tab === 'rotinas');
  document.getElementById('view-geral').classList.toggle('ativo', tab === 'geral');
  document.getElementById('view-rotinas').classList.toggle('ativo', tab === 'rotinas');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RELÃ“GIO â€” horÃ¡rio de BrasÃ­lia sincronizado pela internet
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let clockOffset = 0;      // diferenÃ§a em ms entre hora internet e relÃ³gio local
let clockSynced = false;  // true quando veio da internet

async function syncInternetTime() {
  try {
    const r = await fetch('https://worldtimeapi.org/api/timezone/America/Sao_Paulo');
    if(!r.ok) throw new Error('status ' + r.status);
    const data = await r.json();
    // unixtime = segundos desde 1970; calcula diferenÃ§a para corrigir relÃ³gio errado
    clockOffset = data.unixtime * 1000 - Date.now();
    clockSynced = true;
    const el = document.getElementById('clock-sync');
    if(el) { el.textContent = 'ğŸŒ BrasÃ­lia'; el.title = 'HorÃ¡rio sincronizado com a internet'; }
  } catch(e) {
    // Sem internet ou API fora â€” usa relÃ³gio local com timezone BrasÃ­lia
    clockSynced = false;
    const el = document.getElementById('clock-sync');
    if(el) { el.textContent = 'ğŸ’» Local'; el.title = 'Usando relÃ³gio do computador (sem internet)'; }
  }
  const selectedChanged = syncSelectedDateWithToday(followToday);
  if(selectedChanged) manualRefresh();
  setFraseDia();
  updateClock();
  if(selectedChanged) loadData();
}

function getBrasiliaDate() {
  // Aplica offset da internet para corrigir relÃ³gios errados
  const now = new Date(Date.now() + clockOffset);
  const parts = new Intl.DateTimeFormat('en-CA', {
    timeZone: TZ, year:'numeric', month:'2-digit', day:'2-digit',
    hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false
  }).formatToParts(now);
  const get = t => parseInt(parts.find(p=>p.type===t).value);
  return new Date(get('year'), get('month')-1, get('day'), get('hour'), get('minute'), get('second'));
}

function getBrasiliaToday() {
  const d = getBrasiliaDate();
  return new Date(d.getFullYear(), d.getMonth(), d.getDate());
}

function dateKey(date) {
  return `${date.getFullYear()}-${pad2(date.getMonth()+1)}-${pad2(date.getDate())}`;
}

function syncSelectedDateWithToday(force=false) {
  const today = getBrasiliaToday();
  const nextKey = dateKey(today);
  const shouldFollow = force || followToday;
  const selectedChanged = shouldFollow && dateKey(selectedDate) !== nextKey;

  brasiliaTodayKey = nextKey;
  if(shouldFollow) {
    selectedDate = today;
    followToday = true;
    updateDateLabel();
  }
  return selectedChanged;
}

function updateClock() {
  const d = getBrasiliaDate();
  if(dateKey(new Date(d.getFullYear(), d.getMonth(), d.getDate())) !== brasiliaTodayKey) {
    const selectedChanged = syncSelectedDateWithToday(followToday);
    setFraseDia();
    if(selectedChanged) {
      manualRefresh();
      loadData();
    }
  }
  document.getElementById('clock-hora').textContent  = `${pad2(d.getHours())}:${pad2(d.getMinutes())}:${pad2(d.getSeconds())}`;
  document.getElementById('clock-dia').textContent   = DIAS[d.getDay()];
  document.getElementById('clock-data').textContent  = `${pad2(d.getDate())} de ${MESES[d.getMonth()]} de ${d.getFullYear()}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FRASE DO DIA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setFraseDia() {
  const d   = getBrasiliaDate();
  const ini = new Date(d.getFullYear(), 0, 0);
  const dia = Math.floor((d - ini) / (1000*60*60*24));
  const idx = (dia - 1 + FRASES.length) % FRASES.length;
  document.getElementById('frase-texto').textContent = FRASES[idx];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVEGAÃ‡ÃƒO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goToToday() {
  syncSelectedDateWithToday(true);
  loadData();
}
function changeDate(delta) {
  selectedDate.setDate(selectedDate.getDate()+delta);
  followToday = dateKey(selectedDate) === brasiliaTodayKey;
  updateDateLabel(); loadData();
}
function updateDateLabel() {
  const d=selectedDate;
  document.getElementById('date-label').textContent =
    `${DIAS[d.getDay()]}, ${pad2(d.getDate())} de ${MESES[d.getMonth()]} de ${d.getFullYear()}`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TICK (countdown)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function tick() {
  countdown--;
  if (countdown<=0) { countdown=status==='erro'?REFRESH_ER:REFRESH_OK; loadData(); }
  const el=document.getElementById('status-timer');
  if(el) el.textContent = status==='erro' ? `Tentando em ${countdown}s` : `PrÃ³xima atualizaÃ§Ã£o em ${countdown}s`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CARREGAMENTO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadData() {
  if(loading) return; loading=true; setDot('loading'); setBtn(false);
  document.getElementById('status-label').textContent = 'Carregando...';

  const y=selectedDate.getFullYear(), m=selectedDate.getMonth();
  const months=[{y,m}, m>0?{y,m:m-1}:{y:y-1,m:11}, m<11?{y,m:m+1}:{y:y+1,m:0}];

  let anyOk=false, anyErr=false;
  for(const {y:yr,m:mo} of months) {
    const key=`${yr}-${mo}`;
    if(mem[key]){ anyOk=true; continue; }
    try {
      mem[key]=await fetchMonthSheet(yr, mo);
      saveCache(key,mem[key]); anyOk=true;
    } catch(e) {
      const c=loadCache(key);
      if(c){ mem[key]=c; anyOk=true; anyErr=true; } else anyErr=true;
    }
  }

  loading=false; setBtn(true);
  if(anyOk&&!anyErr){
    status='ok'; lastOk=new Date(); countdown=REFRESH_OK;
    setDot('ok');
    document.getElementById('status-label').textContent='Dados atualizados';
    showContent(false);
  } else if(anyOk){
    status='cache'; setDot('cache');
    document.getElementById('status-label').textContent='Usando dados salvos (sem internet)';
    showContent(true);
  } else {
    status='erro'; countdown=REFRESH_ER; setDot('offline');
    document.getElementById('status-label').textContent='Sem conexÃ£o';
    showError('Sem conexÃ£o ou planilha inacessÃ­vel.'); return;
  }
  renderDay();
}

function manualRefresh() {
  const y=selectedDate.getFullYear(), m=selectedDate.getMonth();
  [{y,m},m>0?{y,m:m-1}:{y:y-1,m:11},m<11?{y,m:m+1}:{y:y+1,m:0}]
    .forEach(({y:yr,m:mo})=>delete mem[`${yr}-${mo}`]);
  countdown=1;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  JSONP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MONTH_NAME_ALIASES = [
  ['janeiro', 'jan'],
  ['fevereiro', 'fev'],
  ['marco', 'mar'],
  ['abril', 'abr'],
  ['maio', 'mai'],
  ['junho', 'jun'],
  ['julho', 'jul'],
  ['agosto', 'ago'],
  ['setembro', 'set'],
  ['outubro', 'out'],
  ['novembro', 'nov'],
  ['dezembro', 'dez'],
];

function monthSheetCandidates(year, monthIndex) {
  const month = MESES[monthIndex];
  const monthAscii = _strip(month);
  return [...new Set([
    `${year} DayCare ${month}`,
    `${year} DayCare ${monthAscii}`,
    `${year} Daycare ${month}`,
    `${year} Daycare ${monthAscii}`,
    `${year} Day Care ${month}`,
    `${year} Day Care ${monthAscii}`,
    ` ${year} DayCare ${month}`,
    ` ${year} DayCare ${monthAscii}`,
    ` ${year} Daycare ${month}`,
    ` ${year} Daycare ${monthAscii}`,
    `${year} ${month}`,
    `${year} ${monthAscii}`,
    `DayCare ${month}`,
    `DayCare ${monthAscii}`,
    `Daycare ${month}`,
    `Daycare ${monthAscii}`,
    `Day Care ${month}`,
    `Day Care ${monthAscii}`,
  ])];
}

function fetchJsonp(url, callbackParam = 'callback') {
  return new Promise((resolve,reject)=>{
    const cb='zcb_'+Date.now()+'_'+Math.random().toString(36).substr(2,5);
    const sc=document.createElement('script');
    const timer=setTimeout(()=>{ cleanup(); reject(new Error(`Timeout ao carregar ${url}`)); }, 20000);
    function cleanup() {
      clearTimeout(timer);
      delete window[cb];
      sc.parentNode && sc.parentNode.removeChild(sc);
    }
    window[cb] = data => { cleanup(); resolve(data); };
    sc.onerror = ()=>{ cleanup(); reject(new Error(`Falha ao carregar ${url}`)); };
    sc.src = `${url}${url.includes('?') ? '&' : '?'}${callbackParam}=${cb}&t=${Date.now()}`;
    document.head.appendChild(sc);
  });
}

async function fetchMonthSheet(year, monthIndex) {
  const candidates = monthSheetCandidates(year, monthIndex);
  let lastError = null;
  for(const name of candidates) {
    try {
      return await fetchSheet(name);
    } catch(err) {
      lastError = err;
    }
  }
  throw lastError || new Error(`Nao foi possivel localizar a aba ${MESES[monthIndex]} de ${year}.`);
}

function fetchSheet(name) {
  return fetchJsonp(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=reqId:0&sheet=${encodeURIComponent(name)}`, 'responseHandler')
    .then(data => {
      if(!data) throw new Error(`Resposta vazia da aba "${name}"`);
      if(data.status && data.status !== 'ok') {
        const details = (data.errors || [])
          .map(err => err.detailed_message || err.message)
          .filter(Boolean)
          .join(' | ');
        throw new Error(details || `Falha ao carregar a aba "${name}"`);
      }
      if(!data.table) throw new Error(`Aba "${name}" sem tabela retornada`);
      return parseGviz(data.table);
    });
}

function parseGviz(table) {
  const cols=table.cols.map(c=>(c.label||c.id||'').trim().normalize('NFC'));
  return (table.rows||[]).filter(r=>r&&r.c).map(row=>{
    const obj={};
    row.c.forEach((cell,i)=>{
      const key=cols[i]||`col${i}`;
      let val='';
      if(cell&&cell.v!=null){
        if(cell.v instanceof Date){
          const yr=cell.v.getFullYear(), mo=cell.v.getMonth(), dy=cell.v.getDate();
          if(yr===1899&&mo===11&&dy===30){
            val=`${pad2(cell.v.getHours())}:${pad2(cell.v.getMinutes())}`;
          } else {
            val=cell.f!=null?normalizeDateValue(String(cell.f)):formatDateParts(dy, mo+1, yr);
          }
        } else if(typeof cell.v==='string'&&cell.v.startsWith('Date(')){
          const p=cell.v.match(/Date\((-?\d+),(\d+),(\d+)(?:,(\d+),(\d+(?:\.\d+)?))?/);
          if(p){
            const yr=+p[1],mo=+p[2],dy=+p[3];
            if(p[4]!=null&&yr===1899&&mo===11&&dy===30){
              // Hora pura â€” sempre HH:MM do valor bruto (ignora cell.f que pode vir "10h")
              const hr=+p[4],mn=Math.round(+p[5]);
              val=`${pad2(hr)}:${pad2(mn)}`;
            } else {
              // Data (com ou sem hora)
              val=cell.f!=null?normalizeDateValue(String(cell.f)):formatDateParts(dy, mo+1, yr);
            }
          } else { val=cell.f!=null?String(cell.f):String(cell.v); }
        } else {
          val=cell.f!=null?String(cell.f):String(cell.v);
          // Normaliza hora digitada como texto: "10h05"â†’"10:05" / "10h"â†’"10:00" / "13;30"â†’"13:30"
          val=val.replace(/^(\d{1,2})[h;:](\d{1,2})$/i,
                (_,h,m)=>`${String(+h).padStart(2,'0')}:${String(+m).padStart(2,'0')}`)
               .replace(/^(\d{1,2})h$/i,
                (_,h)=>`${String(+h).padStart(2,'0')}:00`);
        }
      }
      obj[key]=val;
      // Guarda tambÃ©m sob chave sem acento (garante busca independente de encoding)
      const keySimples=key.normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
      if(keySimples!==key) obj[keySimples]=val;
    });
    return obj;
  }).filter(r=>Object.values(r).some(x=>x!==''));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CACHE LOCAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveCache(k,d){ try{const a=JSON.parse(localStorage.getItem(CACHE_KEY)||'{}'); a[k]={d,t:Date.now()}; localStorage.setItem(CACHE_KEY,JSON.stringify(a));}catch(_){} }
function loadCache(k)  { try{const e=(JSON.parse(localStorage.getItem(CACHE_KEY)||'{}')||{})[k]; return(e&&Date.now()-e.t<86400000)?e.d:null;}catch(_){return null;} }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TO-DO (marcar como feito)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function todoKey() {
  const d=selectedDate, p=x=>String(x).padStart(2,'0');
  return `${TODO_KEY}_${d.getFullYear()}-${p(d.getMonth()+1)}-${p(d.getDate())}`;
}
function getTodo()     { try{return JSON.parse(localStorage.getItem(todoKey())||'{}')}catch(_){return {};} }
function saveTodo(obj) { try{localStorage.setItem(todoKey(),JSON.stringify(obj));}catch(_){} }
function toggleTodo(blockId, nome) {
  const obj=getTodo(), k=`${blockId}::${nome}`;
  obj[k]=!obj[k]; saveTodo(obj);
  const el=document.querySelector(`[data-todo="${blockId}::${nome}"]`);
  if(el) el.classList.toggle('done', !!obj[k]);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ALARME â€” dispara 5 MINUTOS ANTES do banho
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function parseHora(str) {
  if(!str) return null;
  str = str.trim().toLowerCase().replace(/;/g, ':');
  let m;
  if((m=str.match(/^(\d{1,2})h(\d{2})?$/))) return { h:+m[1], min:m[2]?+m[2]:0 };
  if((m=str.match(/^(\d{1,2}):(\d{2})$/)))  return { h:+m[1], min:+m[2] };
  return null;
}

// Separa "Kako 17:10" â†’ { name:"Kako", time:"17:10" }
// Se nÃ£o tiver horÃ¡rio, retorna o valor completo como nome
function parseNameTime(str) {
  if(!str) return { name:'', time:'' };
  const m = str.trim().match(/^(.*?)\s+((\d{1,2})[h:;](\d{2}))$/i);
  if(m) return { name: m[1].trim(), time: m[2].replace(/[h;]/i,':') };
  return { name: str.trim(), time: '' };
}

// Ordena entradas por horÃ¡rio crescente (sem horÃ¡rio vai para o final)
function sortByTime(entries) {
  return entries.slice().sort((a, b) => {
    const ta = parseHora(a.time), tb = parseHora(b.time);
    if(!ta && !tb) return 0;
    if(!ta) return 1;
    if(!tb) return -1;
    return (ta.h*60+ta.min) - (tb.h*60+tb.min);
  });
}

function checkAlarm() {
  if(alarmActive) return;
  const now  = getBrasiliaDate();
  const y=selectedDate.getFullYear(), m=selectedDate.getMonth();
  const all  = mem[`${y}-${m}`]||[];
  const date = selectedDateStr();
  const rows = rowsForSelectedDate(all);
  const triggered = JSON.parse(sessionStorage.getItem(ALARM_KEY)||'{}');

  const toFire = [];
  for(const src of ALARM_SOURCES) {
    for(const row of rows) {
      const nome  = vAny(row, src.nomeCols);
      const horaS = vAny(row, src.horaCols);
      if(!nome||!horaS) continue;
      const hora  = parseHora(horaS);
      if(!hora) continue;

      let alarmH   = hora.h;
      let alarmMin = hora.min - 5;
      if(alarmMin < 0) { alarmMin += 60; alarmH -= 1; }
      if(alarmH < 0) alarmH = 23;

      if(alarmH===now.getHours() && alarmMin===now.getMinutes()) {
        const key = `${date}_${src.nomeCols[0]}_${nome}_${horaS}`;
        if(!triggered[key]) {
          triggered[key]=true;
          toFire.push({ nome, horaS, icon:src.icon, msg:src.msg });
        }
      }
    }
  }

  if(toFire.length > 0) {
    sessionStorage.setItem(ALARM_KEY, JSON.stringify(triggered));
    // Agrupa eventos do mesmo tipo/horÃ¡rio â€” mostra todos os nomes juntos
    const grupos = {};
    for(const e of toFire) {
      const gKey = `${e.msg}__${e.horaS}`;
      if(!grupos[gKey]) grupos[gKey] = { icon:e.icon, msg:e.msg, hora:e.horaS, nomes:[] };
      grupos[gKey].nomes.push(e.nome);
    }
    const g = Object.values(grupos)[0];
    triggerAlarm(g.nomes, g.hora, g.icon, g.msg);
  }
}

function triggerAlarm(nomes, hora, icon='â°', msg='Prepare para o banho das') {
  alarmActive=true;
  const display = Array.isArray(nomes) ? nomes.join(', ') : nomes;
  document.getElementById('alarm-icon-dyn').textContent = icon;
  document.getElementById('alarm-nome').textContent = display;
  document.getElementById('alarm-msg').textContent  = `${msg} ${hora}`;
  document.getElementById('alarm-overlay').classList.add('active');
  playBeep();
}

function dismissAlarm() {
  alarmActive=false;
  document.getElementById('alarm-overlay').classList.remove('active');
}

function testarAlarme() {
  triggerAlarm(['ğŸ¾ Kako', 'ğŸ¾ Luna', 'ğŸ¾ Thor'], '14:30', 'ğŸ›', 'Prepare para o banho das');
}

function playBeep() {
  try {
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    // Despertador antigo: onda quadrada (Ã¡spera), dois tons alternando rÃ¡pido
    const DURATION = 4;     // segundos tocando
    const RATE     = 12;    // badaladas por segundo
    const STEP     = 1 / RATE;
    const FREQS    = [1040, 1320]; // dois tons alternados

    const osc  = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain);
    gain.connect(ctx.destination);
    osc.type = 'square'; // onda quadrada = som Ã¡spero/estridento
    gain.gain.setValueAtTime(0, ctx.currentTime);

    for (let i = 0; i < RATE * DURATION; i++) {
      const t = ctx.currentTime + i * STEP;
      osc.frequency.setValueAtTime(FREQS[i % 2], t);
      gain.gain.setValueAtTime(0.85, t);
      gain.gain.setValueAtTime(0,    t + STEP * 0.45);
    }

    osc.start(ctx.currentTime);
    osc.stop(ctx.currentTime + DURATION + 0.1);
  } catch(_){}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  RENDERIZAÃ‡ÃƒO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDay() {
  const y=selectedDate.getFullYear(), m=selectedDate.getMonth();
  const all=mem[`${y}-${m}`]||[];
  const rows=rowsForSelectedDate(all);
  const todo=getTodo();
  const blocks=getRenderableBlocks(rows);

  // â”€â”€â”€ ABA: ROTINAS AMIGOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.getElementById('blocks-grid').innerHTML =
    blocks.map(b=>buildBlock(b, sortByTime(b.fn(rows).filter(e=>e.name&&e.name!=='')), todo)).join('');

  // â”€â”€â”€ ABA: VISÃƒO GERAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const totalDia = rows.length;
  document.getElementById('geral-subtitulo').textContent =
    `${totalDia} peludinho${totalDia!==1?'s':''} registrado${totalDia!==1?'s':''} hoje`;

  document.getElementById('geral-grid').innerHTML = blocks.map(b => {
    const entries  = sortByTime(b.fn(rows).filter(e=>e.name&&e.name!==''));
    const count    = entries.length;
    const isFuturo = b.color === 'futuro';
    const isZero   = !isFuturo && count === 0;
    return `
      <div class="geral-card ${b.color}">
        <div class="geral-icon">${b.icon}</div>
        <div class="geral-title">${b.title}</div>
        <div class="geral-count${isZero?' zero':''}">${isFuturo ? 'â€”' : count}</div>
        <div class="geral-label">${isFuturo ? 'em breve' : count===1 ? 'peludinho' : 'peludinhos'}</div>
      </div>`;
  }).join('');
}

function buildBlock(b, entries, todo) {
  if(b.color==='futuro') return `
    <div class="block futuro">
      <div class="block-header"><span class="block-icon">${b.icon}</span><span class="block-title">${b.title}</span></div>
      <div class="block-body"><div class="block-empty">Coluna futura</div></div>
    </div>`;

  const count=entries.length;
  const isSpecial = b.special==='banho';

  const body = count===0
    ? `<div class="block-empty">Nenhum registro para hoje</div>`
    : entries.map(e=>{
        const key=`${b.id}::${e.name}`;
        const done=todo[key]?'done':'';
        if(isSpecial) return `
          <div class="block-entry banho-entry ${done}" data-todo="${key}" onclick="toggleTodo('${b.id}','${e.name.replace(/'/g,"\\'")}')">
            <span class="entry-name">${e.name}</span>
            ${e.time?`<span class="entry-time">${e.time}</span>`:''}
            <span class="entry-check">âœ…</span>
          </div>`;
        return `
          <div class="block-entry ${done}" data-todo="${key}" onclick="toggleTodo('${b.id}','${e.name.replace(/'/g,"\\'")}')">
            <span class="entry-name">${e.name}</span>
            ${e.time?`<span class="entry-time">${e.time}</span>`:''}
            <span class="entry-check">âœ…</span>
          </div>`;
      }).join('');

  return `
    <div class="block ${b.color}">
      <div class="block-header">
        <span class="block-icon">${b.icon}</span>
        <span class="block-title">${b.title}</span>
        <span class="block-count">${count||''}</span>
      </div>
      <div class="block-body">${body}</div>
    </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UI HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setDot(s){ const d=document.getElementById('status-dot'); d.className='dot'+(s!=='ok'?' '+s:''); }
function setBtn(en){ document.getElementById('btn-refresh').disabled=!en; }

function showContent(cache) {
  document.getElementById('loading-box').style.display='none';
  document.getElementById('error-box').style.display='none';
  document.getElementById('content').style.display='block';
  const b=document.getElementById('cache-banner');
  if(cache&&lastOk){
    b.style.display='block';
    const p=x=>String(x).padStart(2,'0');
    document.getElementById('cache-time').textContent=`${p(lastOk.getHours())}:${p(lastOk.getMinutes())}`;
  } else b.style.display='none';
}

function showError(msg){
  document.getElementById('loading-box').style.display='none';
  document.getElementById('content').style.display='none';
  document.getElementById('error-box').style.display='flex';
  document.getElementById('error-msg').textContent=msg;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DIAGNÃ“STICO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function verColunas() {
  const y=selectedDate.getFullYear(), m=selectedDate.getMonth();
  const all=mem[`${y}-${m}`]||[];
  if(!all.length){ alert('Nenhum dado carregado. Clique em Atualizar primeiro.'); return; }

  const dateStr=selectedDateStr();
  const rows=rowsForSelectedDate(all);

  // Mostra dados brutos das primeiras linhas com algum conteÃºdo (alÃ©m da Data)
  const rowsComDados = rows.filter(r=>Object.entries(r).some(([k,v])=>_norm(k)!=='data'&&v!=='')).slice(0,3);

  let msg = `ğŸ“… Data: ${dateStr} â€” ${rows.length} linhas\n`;
  msg += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;

  // Colunas disponÃ­veis (da primeira linha)
  if(rows.length>0){
    const cols = Object.keys(rows[0]);
    msg += `ğŸ”‘ ${cols.length} colunas encontradas:\n`;
    msg += cols.map(c=>`  "${c}"`).join(', ') + '\n\n';
  }

  // Dados brutos das primeiras linhas com conteÃºdo
  if(rowsComDados.length>0){
    msg += `ğŸ“Š Primeiras linhas com dados:\n`;
    rowsComDados.forEach((r,i)=>{
      const campos = Object.entries(r).filter(([,v])=>v!=='').map(([k,v])=>`${k}="${v}"`);
      msg += `  Linha ${i+1}: ${campos.join(' | ')}\n`;
    });
    msg += '\n';
  }

  // Resultado de cada bloco
  msg += `ğŸ“¦ Resultado por bloco:\n`;
  getRenderableBlocks(rows).forEach(b=>{
    if(b.color==='futuro') return;
    const entries = b.fn(rows).filter(e=>e.name&&e.name!=='');
    msg += `  ${b.icon} ${b.title}: ${entries.length} item(ns)`;
    if(entries.length>0) msg += ` â†’ ${entries.map(e=>e.name+(e.time?' '+e.time:'')).join(', ')}`;
    msg += '\n';
  });

  alert(msg);
}

function limparCache() {
  if(!confirm('Limpar cache local e buscar dados frescos da planilha?')) return;
  // Remove todos os itens do localStorage relacionados ao dashboard
  Object.keys(localStorage).forEach(k=>{ if(k.startsWith('zeluz_')) localStorage.removeItem(k); });
  // Limpa memÃ³ria
  Object.keys(mem).forEach(k=>delete mem[k]);
  alert('Cache limpo! Clique em ğŸ”„ Atualizar agora.');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  START
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
init();
</script>
</body>
</html>
